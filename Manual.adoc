# Beschreibung und Bedienungsanleitung zum Projekt

## Struktur

### Anwendung und Geschäftslogik

Die Geschäftslogik (darunter verstehen wir hier alles, was in java geschrieben ist und direkt zum Betrieb der Anwendung beiträgt, Tests und Templates ausgeschlossen), ist in folgende vier Packages unterteilt:

 * model: Hier werden die Entitäten aufbewahrt. "Artikel" enthält alle Attribute, die zum Erzeugen eines neuen Artikels durch einen eingeloggten Benutzer benötigt werden. Für jeden Artikel werden neben Mietpreis, Kaution usw. die Flags verfuegbar und aktiv gesetzt. 

 Benutzer definiert einen individuellen User und enthält alle dazu notwendigen Attribute. Gleiches gilt für Reservierung, Adresse und Beschwerde. 

 Die Methoden in der Klasse Reservierung dienen dazu, Anfang, Ende und Dauer einer Reservierung anzuzeigen. Die Klassen sind untereinander verbunden: 

 Die Adresse wird in den Artikel als Standort eingebettet, jeder Artikel hat einen Benutzer als Eigentümer, jede Reservierung enthält einen Benutzer, der den Gegenstand ausleihen will und den Gegenstand selbst, über den man auch den Eigentümer ermitteln kann. Eine Beschwerde enthält eine Reservierung, auf die sie sich bezieht, den Nutzer, der sich beschwert hat, und den Benutzer, dem am Ende Recht gegeben wird (entweder der verleihende oder der ausleihende Benutzer).

 * dataaccess: Hier befinden sich die Repositories, in denen verschiedene Methoden des Interfaces CrudRepository überschrieben werden. Sie dienen dazu, mit der Datenbank zu kommunizieren und die Objekte in der Datenbank zu verwalten. Darüber hinaus nutzen die Methoden die Verbindungen zwischen den einzelnen Objekten aus, um den Zugriff auf einzelne Objekte zu ermöglichen. So kann man zum Beispiel durch die Methode findByArtikelAndLeihender in ReservierungRepository eine Reservierung anhand des Artikels, auf den sie sich bezieht, und eines Benutzers, der sich den Artikel ausleihen will, suchen. Die Klasse FotoStorage und ihr Interface sorgen für die Speicherung der Links zu den Fotos in der Datenbank, wobei die Foto-Dateien auch einen neuen und eindeutigen Namen erhalten.

 * services: Die Klassen in diesem Package enthalten einerseits Wrapper-Methoden für Methoden aus den Repositories, die im Controller benötigte Aufgaben erfüllen. Andererseits enthalten sie auch Methoden mit komplexerer Logik, wie beispielsweise isAllowedReservierungsDate im ReservierungsService, die überprüfen soll, ob der Zeitraum für eine Reservierung gültig oder schon durch eine andere Reservierung belegt ist. Zweck der Services ist, dass im Controller möglichst keine Logik vorhanden ist, beziehungsweise möglichst alles, was für das korrekte Funktionieren des Systems an Logik benötigt wird, getestet werden kann. Die Services ArtikelService und ReservierungsService beziehen sich auf den ArtikelController, der BenutzerService auf den BenutzerController.

 * web: Hier befinden sich die einzelnen Controller und die Konfiguration für Spring Security (TODO: Beschreiben, was in WebSecurityConfig genau passiert).

 ### Resources

 Hier werden die html-Seiten sowie die hochgeladenen Fotos gespeichert. Es gibt zwei application.properties-Dateien, wobei eine für den regulären Betrieb verwendet wird und Postgres einbindet, die andere (-dev) hingegen fürs Testing (unter Einbindung von H2).

 * templates:

 ### Testing

Wir testen bislang einerseits die Repositories und die Methoden der Modell-Objekte (sofern sie welche haben), andererseits die Services, welche Logik enthalten, die ansonsten im Controller untergebracht und damit schwer zu testen wären.

 * modelTest: Wir haben die Testklassen für die Repositories jeweils so aufgebaut, dass wir zunächst die benötigten Objekte erzeugen und diese dann mit der Annotatioin @Before vor jedem Test neu in die Datenbank speichern. Mit @After werden die Datenbanken nach jedem Test wieder gelehrt. Alle Klassen enthalten Tests, die die Korrekte Wiedergewinnung und Aktualisierung der Daten, welche an die Datenbank geschickt werden, überprüfen. Zudem werden sämtliche überschriebenen Methoden aus den Repositories getestet. Wenn Klassen aus model über Methoden verfügen, werden diese ebenfalls getestet.

 * serviceTests: Die Logik in den Services enthält sowohl simple als auch komplexere Methoden. Bei ersteren reicht teils ein (sinnvoller Test, bei Letzteren haben wir uns bemüht, möglichst alle Fälle abzudecken, bei denen Fehler auftreten könnten. So wird die Methode isAllowedReservierungsDate aus dem ReservierungsService darauf getestet, dass sie ein illegales Anfangsdatum, Enddatum, Anfangs-und Enddatum oder eine ungültige Reservierung mit legalem Anfangs- und Enddatum erkennt. Auch die Grenzfälle (nur Start- oder Enddatum einer Reservierung sind illegal) werden getestet.
